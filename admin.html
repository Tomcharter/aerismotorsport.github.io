<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin — Aeris Motorsport</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" type="image/webp" href="images/Logo.webp">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Password Gate -->
  <div class="admin-login-overlay" id="login-overlay">
    <div class="admin-login-box">
      <img src="images/Logo.webp" alt="Aeris Motorsport" style="width:80px;margin:0 auto 1.5rem;">
      <h2>Admin Access</h2>
      <p class="text-secondary" style="margin-bottom:1.5rem;">Enter the password to continue.</p>
      <div class="form-group">
        <input type="password" id="login-password" placeholder="Password" autofocus>
      </div>
      <p id="login-error" style="color:var(--color-danger);font-size:0.85rem;margin-top:0.5rem;display:none;">Incorrect password.</p>
      <button class="btn btn-primary" style="width:100%;margin-top:1rem;" onclick="attemptLogin()">Enter</button>
    </div>
  </div>

  <nav class="site-nav"></nav>

  <main style="display:none;" id="admin-main">
    <div class="page-header">
      <h1>Admin <span class="text-accent">Panel</span></h1>
      <p>Manage drivers, results, and championship data</p>
    </div>

    <section class="section">
      <div class="container">
        <!-- Tab Bar -->
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="drivers">Drivers</button>
          <button class="admin-tab" data-tab="results">Results</button>
          <button class="admin-tab" data-tab="championships">Championships</button>
        </div>

        <!-- Drivers Tab -->
        <div class="admin-panel active" id="panel-drivers">
          <div class="admin-toolbar">
            <button class="btn btn-primary" onclick="addDriver()">+ Add Driver</button>
          </div>
          <div id="drivers-form-area"></div>
          <div id="drivers-list" class="admin-list"></div>
        </div>

        <!-- Results Tab -->
        <div class="admin-panel" id="panel-results">
          <div class="admin-toolbar">
            <button class="btn btn-primary" onclick="addResult()">+ Add Result</button>
          </div>
          <div id="results-form-area"></div>
          <div id="results-list" class="admin-list"></div>
        </div>

        <!-- Championships Tab -->
        <div class="admin-panel" id="panel-championships">
          <h3 class="mt-4">Current Standings</h3>
          <div class="admin-toolbar mt-2">
            <button class="btn btn-primary" onclick="addCurrentChampionship()">+ Add Championship</button>
          </div>
          <div id="current-form-area"></div>
          <div id="current-list" class="admin-list"></div>

          <h3 class="mt-4">Past Wins</h3>
          <div class="admin-toolbar mt-2">
            <button class="btn btn-primary" onclick="addPastWin()">+ Add Past Win</button>
          </div>
          <div id="won-form-area"></div>
          <div id="won-list" class="admin-list"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer" style="display:none;"></footer>

  <script src="js/main.js"></script>
  <script>
    /* ============================================
       Admin Panel — Password Gate
       ============================================ */
    const PASS_HASH = 'd0f5fe6b15cee2b54a6a8acb222a35cea48bb69171af2ff42d4049bd067fc1f8';

    async function sha256(text) {
      const data = new TextEncoder().encode(text);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function attemptLogin() {
      const input = document.getElementById('login-password').value;
      const hash = await sha256(input);
      if (hash === PASS_HASH) {
        sessionStorage.setItem('admin-auth', '1');
        unlockAdmin();
      } else {
        document.getElementById('login-error').style.display = 'block';
        document.getElementById('login-password').value = '';
        document.getElementById('login-password').focus();
      }
    }

    function unlockAdmin() {
      document.getElementById('login-overlay').style.display = 'none';
      document.getElementById('admin-main').style.display = '';
      document.querySelector('.site-footer').style.display = '';
    }

    // Allow Enter key to submit
    document.getElementById('login-password').addEventListener('keydown', e => {
      if (e.key === 'Enter') attemptLogin();
    });

    // Check session on load
    if (sessionStorage.getItem('admin-auth') === '1') {
      unlockAdmin();
    }
  </script>
  <script>
    /* ============================================
       Admin Panel — Data Management
       ============================================ */

    // --- State ---
    let driversData = [];
    let resultsData = [];
    let championshipsData = { current: [], won: [] };

    // --- Tab Switching ---
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
      });
    });

    // --- Helpers ---
    function slugify(text) {
      return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    }

    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function saveAll() {
      localStorage.setItem('admin-drivers', JSON.stringify(driversData));
      localStorage.setItem('admin-results', JSON.stringify(resultsData));
      localStorage.setItem('admin-championships', JSON.stringify(championshipsData));
    }

    // =============================================
    //  DRIVERS
    // =============================================

    function renderDrivers() {
      const list = document.getElementById('drivers-list');
      if (driversData.length === 0) {
        list.innerHTML = '<p class="text-secondary" style="text-align:center;padding:2rem;">No drivers yet. Click "+ Add Driver" to get started.</p>';
        return;
      }
      list.innerHTML = driversData.map((d, i) => `
        <div class="admin-entry card">
          <div class="admin-entry-header">
            <div>
              <strong>${escapeHTML(d.name)}</strong>
              <span class="text-secondary"> — ${escapeHTML(d.role)}</span>
            </div>
            <div class="admin-entry-actions">
              <button class="btn-sm btn-edit" onclick="editDriver(${i})">Edit</button>
              <button class="btn-sm btn-delete" onclick="deleteDriver(${i})">Delete</button>
            </div>
          </div>
          <div class="admin-entry-details">
            <span>iRating: ${escapeHTML(d.irating || '—')}</span>
            <span>Car: ${escapeHTML(d.favouriteCar || '—')}</span>
            <span>Track: ${escapeHTML(d.favouriteTrack || '—')}</span>
          </div>
        </div>
      `).join('');
    }

    function driverForm(driver, onSave, onCancel) {
      const d = driver || { name: '', role: '', irating: '', favouriteCar: '', favouriteTrack: '', bio: '', photo: '' };
      return `
        <div class="admin-form card">
          <h4>${driver ? 'Edit Driver' : 'Add New Driver'}</h4>
          <div class="form-grid">
            <div class="form-group">
              <label>Name *</label>
              <input type="text" id="df-name" value="${escapeHTML(d.name)}" required>
            </div>
            <div class="form-group">
              <label>Role *</label>
              <input type="text" id="df-role" value="${escapeHTML(d.role)}" placeholder="e.g. Driver, Team Owner & Driver">
            </div>
            <div class="form-group">
              <label>iRating</label>
              <input type="text" id="df-iracing" value="${escapeHTML(d.irating || '')}">
            </div>
            <div class="form-group">
              <label>Favourite Car</label>
              <input type="text" id="df-car" value="${escapeHTML(d.favouriteCar || '')}">
            </div>
            <div class="form-group">
              <label>Favourite Track</label>
              <input type="text" id="df-track" value="${escapeHTML(d.favouriteTrack || '')}">
            </div>
            <div class="form-group">
              <label>Photo URL</label>
              <input type="text" id="df-photo" value="${escapeHTML(d.photo || '')}" placeholder="Optional">
            </div>
            <div class="form-group form-full">
              <label>Bio</label>
              <textarea id="df-bio" rows="3">${escapeHTML(d.bio || '')}</textarea>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="${onSave}">Save</button>
            <button class="btn btn-outline" onclick="${onCancel}">Cancel</button>
          </div>
        </div>
      `;
    }

    function addDriver() {
      document.getElementById('drivers-form-area').innerHTML = driverForm(null, 'saveNewDriver()', 'cancelDriverForm()');
    }

    function cancelDriverForm() {
      document.getElementById('drivers-form-area').innerHTML = '';
    }

    function saveNewDriver() {
      const name = document.getElementById('df-name').value.trim();
      if (!name) { alert('Name is required.'); return; }
      const id = 'driver-' + slugify(name);
      driversData.push({
        id,
        name,
        role: document.getElementById('df-role').value.trim(),
        irating: document.getElementById('df-iracing').value.trim(),
        bio: document.getElementById('df-bio').value.trim(),
        favouriteCar: document.getElementById('df-car').value.trim(),
        favouriteTrack: document.getElementById('df-track').value.trim(),
        photo: document.getElementById('df-photo').value.trim()
      });
      cancelDriverForm();
      renderDrivers();
      saveAll();
    }

    function editDriver(index) {
      const d = driversData[index];
      document.getElementById('drivers-form-area').innerHTML = driverForm(d, `saveEditDriver(${index})`, 'cancelDriverForm()');
    }

    function saveEditDriver(index) {
      const name = document.getElementById('df-name').value.trim();
      if (!name) { alert('Name is required.'); return; }
      driversData[index] = {
        id: driversData[index].id,
        name,
        role: document.getElementById('df-role').value.trim(),
        irating: document.getElementById('df-iracing').value.trim(),
        bio: document.getElementById('df-bio').value.trim(),
        favouriteCar: document.getElementById('df-car').value.trim(),
        favouriteTrack: document.getElementById('df-track').value.trim(),
        photo: document.getElementById('df-photo').value.trim()
      };
      cancelDriverForm();
      renderDrivers();
      saveAll();
    }

    function deleteDriver(index) {
      if (!confirm(`Delete "${driversData[index].name}"?`)) return;
      driversData.splice(index, 1);
      renderDrivers();
      saveAll();
    }

    // =============================================
    //  RESULTS
    // =============================================

    function renderResults() {
      const list = document.getElementById('results-list');
      if (resultsData.length === 0) {
        list.innerHTML = '<p class="text-secondary" style="text-align:center;padding:2rem;">No results yet. Click "+ Add Result" to get started.</p>';
        return;
      }
      // Sort by date descending for display
      const sorted = resultsData.map((r, i) => ({ ...r, _idx: i })).sort((a, b) => new Date(b.date) - new Date(a.date));
      list.innerHTML = sorted.map(r => {
        const dateStr = new Date(r.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        return `
          <div class="admin-entry card">
            <div class="admin-entry-header">
              <div>
                <strong>${escapeHTML(r.track)}</strong>
                <span class="text-secondary"> — ${dateStr}</span>
              </div>
              <div class="admin-entry-actions">
                <button class="btn-sm btn-edit" onclick="editResult(${r._idx})">Edit</button>
                <button class="btn-sm btn-delete" onclick="deleteResult(${r._idx})">Delete</button>
              </div>
            </div>
            <div class="admin-entry-details">
              <span>${escapeHTML(r.season)}</span>
              <span>${escapeHTML(r.series)}</span>
              <span>${escapeHTML(r.car)}</span>
              <span>P${r.startPos} &rarr; P${r.finishPos}</span>
              <span>${r.drivers.map(escapeHTML).join(', ')}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    function resultForm(result, onSave, onCancel) {
      const r = result || { date: '', season: '', series: '', track: '', car: '', startPos: '', finishPos: '', drivers: [], notes: '' };
      const driversStr = Array.isArray(r.drivers) ? r.drivers.join(', ') : '';
      return `
        <div class="admin-form card">
          <h4>${result ? 'Edit Result' : 'Add New Result'}</h4>
          <div class="form-grid">
            <div class="form-group">
              <label>Date *</label>
              <input type="date" id="rf-date" value="${r.date}">
            </div>
            <div class="form-group">
              <label>Season *</label>
              <input type="text" id="rf-season" value="${escapeHTML(r.season)}" placeholder="e.g. 2025 S1">
            </div>
            <div class="form-group">
              <label>Series *</label>
              <input type="text" id="rf-series" value="${escapeHTML(r.series)}" placeholder="e.g. GT3 Sprint Series">
            </div>
            <div class="form-group">
              <label>Track *</label>
              <input type="text" id="rf-track" value="${escapeHTML(r.track)}">
            </div>
            <div class="form-group">
              <label>Car *</label>
              <input type="text" id="rf-car" value="${escapeHTML(r.car)}">
            </div>
            <div class="form-group">
              <label>Start Position</label>
              <input type="number" id="rf-startpos" min="1" value="${r.startPos}">
            </div>
            <div class="form-group">
              <label>Finish Position</label>
              <input type="number" id="rf-finishpos" min="1" value="${r.finishPos}">
            </div>
            <div class="form-group">
              <label>Drivers (comma-separated)</label>
              <input type="text" id="rf-drivers" value="${escapeHTML(driversStr)}" placeholder="Alex Morgan, Sarah Chen">
            </div>
            <div class="form-group form-full">
              <label>Notes</label>
              <textarea id="rf-notes" rows="2">${escapeHTML(r.notes || '')}</textarea>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="${onSave}">Save</button>
            <button class="btn btn-outline" onclick="${onCancel}">Cancel</button>
          </div>
        </div>
      `;
    }

    function addResult() {
      document.getElementById('results-form-area').innerHTML = resultForm(null, 'saveNewResult()', 'cancelResultForm()');
    }

    function cancelResultForm() {
      document.getElementById('results-form-area').innerHTML = '';
    }

    function nextResultId() {
      let max = 0;
      resultsData.forEach(r => {
        const n = parseInt(r.id.replace('race-', ''), 10);
        if (n > max) max = n;
      });
      return 'race-' + (max + 1);
    }

    function collectResultFields() {
      const date = document.getElementById('rf-date').value;
      const track = document.getElementById('rf-track').value.trim();
      if (!date || !track) { alert('Date and Track are required.'); return null; }
      return {
        date,
        season: document.getElementById('rf-season').value.trim(),
        series: document.getElementById('rf-series').value.trim(),
        track,
        car: document.getElementById('rf-car').value.trim(),
        startPos: parseInt(document.getElementById('rf-startpos').value, 10) || 0,
        finishPos: parseInt(document.getElementById('rf-finishpos').value, 10) || 0,
        drivers: document.getElementById('rf-drivers').value.split(',').map(s => s.trim()).filter(Boolean),
        notes: document.getElementById('rf-notes').value.trim()
      };
    }

    function saveNewResult() {
      const fields = collectResultFields();
      if (!fields) return;
      fields.id = nextResultId();
      resultsData.push(fields);
      cancelResultForm();
      renderResults();
      saveAll();
    }

    function editResult(index) {
      const r = resultsData[index];
      document.getElementById('results-form-area').innerHTML = resultForm(r, `saveEditResult(${index})`, 'cancelResultForm()');
    }

    function saveEditResult(index) {
      const fields = collectResultFields();
      if (!fields) return;
      fields.id = resultsData[index].id;
      resultsData[index] = fields;
      cancelResultForm();
      renderResults();
      saveAll();
    }

    function deleteResult(index) {
      const r = resultsData[index];
      if (!confirm(`Delete result at "${r.track}" on ${r.date}?`)) return;
      resultsData.splice(index, 1);
      renderResults();
      saveAll();
    }

    // =============================================
    //  CHAMPIONSHIPS — Current Standings
    // =============================================

    function renderCurrentChampionships() {
      const list = document.getElementById('current-list');
      const current = championshipsData.current;
      if (current.length === 0) {
        list.innerHTML = '<p class="text-secondary" style="text-align:center;padding:2rem;">No current championships.</p>';
        return;
      }
      list.innerHTML = current.map((c, i) => `
        <div class="admin-entry card">
          <div class="admin-entry-header">
            <div>
              <strong>${escapeHTML(c.season)}</strong>
              <span class="text-secondary"> — ${escapeHTML(c.series)}</span>
            </div>
            <div class="admin-entry-actions">
              <button class="btn-sm btn-edit" onclick="editCurrentChampionship(${i})">Edit</button>
              <button class="btn-sm btn-delete" onclick="deleteCurrentChampionship(${i})">Delete</button>
            </div>
          </div>
          <div class="admin-entry-details">
            <span>Team Position: <strong class="text-accent">P${c.position}</strong></span>
            <span>Points: ${c.points}</span>
            ${c.split ? `<span>Split: ${escapeHTML(c.split)}</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function currentChampionshipForm(champ, onSave, onCancel) {
      const c = champ || { season: '', series: '', position: '', points: '', split: '' };
      return `
        <div class="admin-form card">
          <h4>${champ ? 'Edit Championship' : 'Add Current Championship'}</h4>
          <div class="form-grid">
            <div class="form-group">
              <label>Season *</label>
              <input type="text" id="cf-season" value="${escapeHTML(c.season)}" placeholder="e.g. 2025 S1">
            </div>
            <div class="form-group">
              <label>Series *</label>
              <input type="text" id="cf-series" value="${escapeHTML(c.series)}">
            </div>
            <div class="form-group">
              <label>Team Position *</label>
              <input type="number" id="cf-position" min="1" value="${c.position}">
            </div>
            <div class="form-group">
              <label>Points *</label>
              <input type="number" id="cf-points" min="0" value="${c.points}">
            </div>
            <div class="form-group">
              <label>Split</label>
              <input type="text" id="cf-split" value="${escapeHTML(c.split || '')}" placeholder="Optional, e.g. Top Split">
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="${onSave}">Save</button>
            <button class="btn btn-outline" onclick="${onCancel}">Cancel</button>
          </div>
        </div>
      `;
    }

    function addCurrentChampionship() {
      document.getElementById('current-form-area').innerHTML = currentChampionshipForm(null, 'saveNewCurrentChampionship()', 'cancelCurrentForm()');
    }

    function cancelCurrentForm() {
      document.getElementById('current-form-area').innerHTML = '';
    }

    function collectCurrentFields() {
      const season = document.getElementById('cf-season').value.trim();
      const series = document.getElementById('cf-series').value.trim();
      const position = parseInt(document.getElementById('cf-position').value, 10);
      const points = parseInt(document.getElementById('cf-points').value, 10);
      if (!season || !series || !position) { alert('Season, Series, and Position are required.'); return null; }
      return {
        season, series,
        position,
        points: points || 0,
        split: document.getElementById('cf-split').value.trim()
      };
    }

    function saveNewCurrentChampionship() {
      const fields = collectCurrentFields();
      if (!fields) return;
      championshipsData.current.push(fields);
      cancelCurrentForm();
      renderCurrentChampionships();
      saveAll();
    }

    function editCurrentChampionship(index) {
      const c = championshipsData.current[index];
      document.getElementById('current-form-area').innerHTML = currentChampionshipForm(c, `saveEditCurrentChampionship(${index})`, 'cancelCurrentForm()');
    }

    function saveEditCurrentChampionship(index) {
      const fields = collectCurrentFields();
      if (!fields) return;
      championshipsData.current[index] = fields;
      cancelCurrentForm();
      renderCurrentChampionships();
      saveAll();
    }

    function deleteCurrentChampionship(index) {
      const c = championshipsData.current[index];
      if (!confirm(`Delete "${c.season} — ${c.series}"?`)) return;
      championshipsData.current.splice(index, 1);
      renderCurrentChampionships();
      saveAll();
    }

    // =============================================
    //  CHAMPIONSHIPS — Past Wins
    // =============================================

    function renderPastWins() {
      const list = document.getElementById('won-list');
      const won = championshipsData.won;
      if (won.length === 0) {
        list.innerHTML = '<p class="text-secondary" style="text-align:center;padding:2rem;">No past wins recorded.</p>';
        return;
      }
      list.innerHTML = won.map((w, i) => `
        <div class="admin-entry card">
          <div class="admin-entry-header">
            <div>
              <strong>${escapeHTML(w.season)}</strong>
              <span class="text-secondary"> — ${escapeHTML(w.series)}</span>
            </div>
            <div class="admin-entry-actions">
              <button class="btn-sm btn-edit" onclick="editPastWin(${i})">Edit</button>
              <button class="btn-sm btn-delete" onclick="deletePastWin(${i})">Delete</button>
            </div>
          </div>
          <div class="admin-entry-details">
            <span>Position: <strong class="text-accent">P${w.position}</strong></span>
            <span>Points: ${w.finalPoints}</span>
            ${w.split ? `<span>Split: ${escapeHTML(w.split)}</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function pastWinForm(win, onSave, onCancel) {
      const w = win || { season: '', series: '', position: 1, finalPoints: '', split: '' };
      return `
        <div class="admin-form card">
          <h4>${win ? 'Edit Past Win' : 'Add Past Win'}</h4>
          <div class="form-grid">
            <div class="form-group">
              <label>Season *</label>
              <input type="text" id="wf-season" value="${escapeHTML(w.season)}" placeholder="e.g. 2024 S4">
            </div>
            <div class="form-group">
              <label>Series *</label>
              <input type="text" id="wf-series" value="${escapeHTML(w.series)}">
            </div>
            <div class="form-group">
              <label>Team Position *</label>
              <input type="number" id="wf-position" min="1" value="${w.position}">
            </div>
            <div class="form-group">
              <label>Final Points</label>
              <input type="number" id="wf-points" value="${w.finalPoints}" min="0">
            </div>
            <div class="form-group">
              <label>Split</label>
              <input type="text" id="wf-split" value="${escapeHTML(w.split || '')}" placeholder="Optional, e.g. Top Split">
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="${onSave}">Save</button>
            <button class="btn btn-outline" onclick="${onCancel}">Cancel</button>
          </div>
        </div>
      `;
    }

    function addPastWin() {
      document.getElementById('won-form-area').innerHTML = pastWinForm(null, 'saveNewPastWin()', 'cancelWonForm()');
    }

    function cancelWonForm() {
      document.getElementById('won-form-area').innerHTML = '';
    }

    function saveNewPastWin() {
      const season = document.getElementById('wf-season').value.trim();
      const series = document.getElementById('wf-series').value.trim();
      const position = parseInt(document.getElementById('wf-position').value, 10);
      if (!season || !series || !position) { alert('Season, Series, and Position are required.'); return; }
      championshipsData.won.push({
        season, series,
        position,
        finalPoints: parseInt(document.getElementById('wf-points').value, 10) || 0,
        split: document.getElementById('wf-split').value.trim()
      });
      cancelWonForm();
      renderPastWins();
      saveAll();
    }

    function editPastWin(index) {
      document.getElementById('won-form-area').innerHTML = pastWinForm(championshipsData.won[index], `saveEditPastWin(${index})`, 'cancelWonForm()');
    }

    function saveEditPastWin(index) {
      const season = document.getElementById('wf-season').value.trim();
      const series = document.getElementById('wf-series').value.trim();
      const position = parseInt(document.getElementById('wf-position').value, 10);
      if (!season || !series || !position) { alert('Season, Series, and Position are required.'); return; }
      championshipsData.won[index] = {
        season, series,
        position,
        finalPoints: parseInt(document.getElementById('wf-points').value, 10) || 0,
        split: document.getElementById('wf-split').value.trim()
      };
      cancelWonForm();
      renderPastWins();
      saveAll();
    }

    function deletePastWin(index) {
      const w = championshipsData.won[index];
      if (!confirm(`Delete "${w.season} — ${w.series}"?`)) return;
      championshipsData.won.splice(index, 1);
      renderPastWins();
      saveAll();
    }

    // =============================================
    //  INIT — Load existing data
    // =============================================

    document.addEventListener('DOMContentLoaded', async () => {
      // Load from localStorage if available, otherwise fall back to JSON files
      const savedDrivers = localStorage.getItem('admin-drivers');
      const savedResults = localStorage.getItem('admin-results');
      const savedChampionships = localStorage.getItem('admin-championships');

      if (savedDrivers && savedResults && savedChampionships) {
        driversData = JSON.parse(savedDrivers);
        resultsData = JSON.parse(savedResults);
        championshipsData = JSON.parse(savedChampionships);
      } else {
        const [drivers, results, championships] = await Promise.all([
          fetchJSON('data/drivers.json'),
          fetchJSON('data/results.json'),
          fetchJSON('data/championships.json'),
        ]);

        if (drivers) driversData = drivers;
        if (results) resultsData = results;
        if (championships) {
          championshipsData = {
            current: championships.current || [],
            won: championships.won || []
          };
        }
        saveAll();
      }

      renderDrivers();
      renderResults();
      renderCurrentChampionships();
      renderPastWins();
    });
  </script>
</body>
</html>
